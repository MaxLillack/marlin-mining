commit 9ce75ab7de2e974509476962ed054e0ff4d6ad81 (from 99e6ce901bdc03dd0bafb6bf7776676b70594218)
Merge: 99e6ce9 22571ca
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Fri Jan 23 06:00:24 2015 -0800

    Merge pull request #1386 from roglio/Development
    
    Fixing a build error for melzi and gfx display

diff --git a/Marlin/pins.h b/Marlin/pins.h
index 0cca6c5..9473239 100644
--- a/Marlin/pins.h
+++ b/Marlin/pins.h
@@ -1279,15 +1279,21 @@
      #define BEEPER -1
      //LCD Pins
      #ifdef DOGLCD
-       // Pins for DOGM SPI LCD Support
-       #define DOGLCD_A0  30
-       #define DOGLCD_CS  29
-       // GLCD features
-       #define LCD_CONTRAST 1
+	   #ifdef U8GLIB_ST7920 //SPI GLCD 12864 ST7920 ( like [www.digole.com] ) For Melzi V2.0
+	  	 #define LCD_PINS_RS 30 //CS chip select /SS chip slave select
+	  	 #define LCD_PINS_ENABLE 29 //SID (MOSI)
+	  	 #define LCD_PINS_D4 17 //SCK (CLK) clock
+	  	 #define BEEPER 27 // Pin 27 is take by LED_Pin, but Melzi LED do nothing with Marlin and I take this pin for BEEPER.... See here > [github.com] , If you want use this pin with Gcode M42 instead BEEPER
+	   #else
+	  	 // Pins for DOGM SPI LCD Support
+	  	 #define DOGLCD_A0 30
+	  	 #define DOGLCD_CS 29
+	  	 #define LCD_CONTRAST 1
+	   #endif
        // Uncomment screen orientation
-         // #define LCD_SCREEN_ROT_0
+       #define LCD_SCREEN_ROT_0
          // #define LCD_SCREEN_ROT_90
-       #define LCD_SCREEN_ROT_180
+         // #define LCD_SCREEN_ROT_180
          // #define LCD_SCREEN_ROT_270
        #else // standard Hitachi LCD controller
        #define LCD_PINS_RS        4
@@ -1309,6 +1315,7 @@
        #endif
      #else
        #define BTN_ENC 16  //the click switch
+       #define LCD_SDSS 28 //to use the SD card reader on the smart controller rather than the melzi board
      #endif //Panelolu2
      //not connected to a pin
      #define SDCARDDETECT -1

commit 9ce75ab7de2e974509476962ed054e0ff4d6ad81 (from 22571ca13d92da0159929f025919f492a533fe73)
Merge: 99e6ce9 22571ca
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Fri Jan 23 06:00:24 2015 -0800

    Merge pull request #1386 from roglio/Development
    
    Fixing a build error for melzi and gfx display

diff --git a/Marlin/Makefile b/Marlin/Makefile
index de33ac1..56e5dda 100644
--- a/Marlin/Makefile
+++ b/Marlin/Makefile
@@ -49,7 +49,7 @@ AVR_TOOLS_PATH ?=
 
 #Programmer configuration
 UPLOAD_RATE        ?= 115200
-AVRDUDE_PROGRAMMER ?= arduino
+AVRDUDE_PROGRAMMER ?= wiring
 # on most linuxes this will be /dev/ttyACM0 or /dev/ttyACM1 
 UPLOAD_PORT        ?= /dev/arduino
 
@@ -361,7 +361,7 @@ else
 AVRDUDE_CONF = $(ARDUINO_INSTALL_DIR)/hardware/tools/avr/etc/avrdude.conf
 endif
 AVRDUDE_FLAGS = -q -q -D -C$(AVRDUDE_CONF) \
-	-p$(MCU) -P$(AVRDUDE_PORT) -c $(AVRDUDE_PROGRAMMER) -cwiring\
+	-p$(MCU) -P$(AVRDUDE_PORT) -c$(AVRDUDE_PROGRAMMER) \
 	-b$(UPLOAD_RATE)
 
 # Define all object files.
diff --git a/Marlin/boards.h b/Marlin/boards.h
index af249c7..7f21946 100644
--- a/Marlin/boards.h
+++ b/Marlin/boards.h
@@ -28,7 +28,7 @@
 #define BOARD_ULTIMAKER         7    // Ultimaker
 #define BOARD_ULTIMAKER_OLD     71   // Ultimaker (Older electronics. Pre 1.5.4. This is rare)
 #define BOARD_ULTIMAIN_2        72   // Ultimainboard 2.x (Uses TEMP_SENSOR 20)
-#define BOARD_3DRAG             77   // 3Drag Controller
+#define BOARD_3DRAG             77   // 3Drag Controller / Vellemann K8200 Controller
 #define BOARD_TEENSYLU          8    // Teensylu
 #define BOARD_RUMBA             80   // Rumba
 #define BOARD_PRINTRBOARD       81   // Printrboard (AT90USB1286)
diff --git a/Marlin/stepper.cpp b/Marlin/stepper.cpp
index b2e7d12..92a6fd1 100644
--- a/Marlin/stepper.cpp
+++ b/Marlin/stepper.cpp
@@ -1110,9 +1110,9 @@ void babystep(const uint8_t axis,const bool direction)
     #ifdef DUAL_X_CARRIAGE
       WRITE(X2_STEP_PIN, !INVERT_X_STEP_PIN);
     #endif
-    {
-    float x=1./float(axis+1)/float(axis+2); //wait a tiny bit
-    }
+
+    _delay_us(1U); // wait 1 microsecond
+
     WRITE(X_STEP_PIN, INVERT_X_STEP_PIN);
     #ifdef DUAL_X_CARRIAGE
       WRITE(X2_STEP_PIN, INVERT_X_STEP_PIN);
@@ -1142,9 +1142,9 @@ void babystep(const uint8_t axis,const bool direction)
     #ifdef DUAL_Y_CARRIAGE
       WRITE(Y2_STEP_PIN, !INVERT_Y_STEP_PIN);
     #endif
-    {
-    float x=1./float(axis+1)/float(axis+2); //wait a tiny bit
-    }
+
+    _delay_us(1U); // wait 1 microsecond
+
     WRITE(Y_STEP_PIN, INVERT_Y_STEP_PIN);
     #ifdef DUAL_Y_CARRIAGE
       WRITE(Y2_STEP_PIN, INVERT_Y_STEP_PIN);
@@ -1174,10 +1174,9 @@ void babystep(const uint8_t axis,const bool direction)
     #ifdef Z_DUAL_STEPPER_DRIVERS
       WRITE(Z2_STEP_PIN, !INVERT_Z_STEP_PIN);
     #endif
-    //wait a tiny bit
-    {
-    float x=1./float(axis+1); //absolutely useless
-    }
+
+    _delay_us(1U); // wait 1 microsecond
+
     WRITE(Z_STEP_PIN, INVERT_Z_STEP_PIN);
     #ifdef Z_DUAL_STEPPER_DRIVERS
       WRITE(Z2_STEP_PIN, INVERT_Z_STEP_PIN);
@@ -1210,10 +1209,8 @@ void babystep(const uint8_t axis,const bool direction)
     WRITE(Y_STEP_PIN, !INVERT_Y_STEP_PIN); 
     WRITE(Z_STEP_PIN, !INVERT_Z_STEP_PIN); 
     
-    //wait a tiny bit
-    {
-    float x=1./float(axis+1); //absolutely useless
-    }
+    _delay_us(1U); // wait 1 microsecond
+
     WRITE(X_STEP_PIN, INVERT_X_STEP_PIN); 
     WRITE(Y_STEP_PIN, INVERT_Y_STEP_PIN); 
     WRITE(Z_STEP_PIN, INVERT_Z_STEP_PIN);

