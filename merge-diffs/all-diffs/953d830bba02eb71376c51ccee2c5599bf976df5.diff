commit 953d830bba02eb71376c51ccee2c5599bf976df5 (from 2a6afee83292e5b741cb99ca4b7b30b7acfe7529)
Merge: 2a6afee 6e6fdb9
Author: Bernhard Kubicek <kubicek@gmx.at>
Date:   Sat Nov 19 17:09:43 2011 +0100

    Merge branch 'Marlin_v1' of https://github.com/ErikZalm/Marlin into Marlin_v1

diff --git a/Marlin/temperature.cpp b/Marlin/temperature.cpp
index b08a800..8578147 100644
--- a/Marlin/temperature.cpp
+++ b/Marlin/temperature.cpp
@@ -99,9 +99,9 @@ static unsigned long previous_millis_heater, previous_millis_bed_heater;
 #endif //MINTEMP
 #ifdef HEATER_0_MAXTEMP
   #ifdef HEATER_0_USES_AD595
-    static int maxttemp_0 = 0;
-  #else
     static int maxttemp_0 = 16383;
+  #else
+    static int maxttemp_0 = 0;
   #endif
 #endif //MAXTEMP
 
@@ -114,9 +114,9 @@ static unsigned long previous_millis_heater, previous_millis_bed_heater;
 #endif //MINTEMP
 #ifdef HEATER_1_MAXTEMP
   #ifdef HEATER_1_USES_AD595
-    static int maxttemp_1 = 0;
-  #else
     static int maxttemp_1 = 16383;
+  #else
+    static int maxttemp_1 = 0;
   #endif
 #endif //MAXTEMP
 
@@ -129,9 +129,9 @@ static unsigned long previous_millis_heater, previous_millis_bed_heater;
 #endif //BED_MINTEMP
 #ifdef BED_MAXTEMP
   #ifdef BED_USES_AD595
-    static int bed_maxttemp = 0;
-  #else
     static int bed_maxttemp = 16383;
+  #else
+    static int bed_maxttemp = 0;
   #endif
 #endif //BED_MAXTEMP
 
@@ -377,7 +377,7 @@ void tp_init()
   TIMSK0 |= (1<<OCIE0B);  
   
   // Wait for temperature measurement to settle
-  delay(500);
+  delay(200);
 
 #ifdef HEATER_0_MINTEMP
   minttemp_0 = temp2analog(HEATER_0_MINTEMP);

commit 953d830bba02eb71376c51ccee2c5599bf976df5 (from 6e6fdb9a4e4b8684cb987b29e90f9e5029dfd55a)
Merge: 2a6afee 6e6fdb9
Author: Bernhard Kubicek <kubicek@gmx.at>
Date:   Sat Nov 19 17:09:43 2011 +0100

    Merge branch 'Marlin_v1' of https://github.com/ErikZalm/Marlin into Marlin_v1

diff --git a/Marlin/Configuration.h b/Marlin/Configuration.h
index 800bb9b..f9a1367 100644
--- a/Marlin/Configuration.h
+++ b/Marlin/Configuration.h
@@ -297,11 +297,10 @@ const bool ENDSTOPS_INVERTING = true; // set to true to invert the logic of the
 
 //automatic temperature: just for testing, this is very dangerous, keep disabled!
 // not working yet.
-//Erik: the settings currently depend dramatically on skeinforge39 or 41.
 //#define AUTOTEMP
-#define AUTOTEMP_MIN 190
-#define AUTOTEMP_MAX 260
-#define AUTOTEMP_FACTOR 1000.  //current target temperature= min+largest buffered espeeds)*FACTOR
+#ifdef AUTOTEMP
+  #define AUTOTEMP_OLDWEIGHT 0.98
+#endif
 
 
 const int dropsegments=5; //everything with less than this number of steps will be ignored as move and joined with the next movement
diff --git a/Marlin/Marlin.pde b/Marlin/Marlin.pde
index c0fc867..f619854 100644
--- a/Marlin/Marlin.pde
+++ b/Marlin/Marlin.pde
@@ -694,8 +694,10 @@ inline void process_commands()
       break;
     case 109: 
     {// M109 - Wait for extruder heater to reach target.
-        LCD_MESSAGEPGM("Heating...");
-        autotemp_enabled=false;
+        LCD_MESSAGEPGM("Heating...");   
+        #ifdef AUTOTEMP
+          autotemp_enabled=false;
+        #endif
         if (code_seen('S')) setTargetHotend0(code_value());
         #ifdef AUTOTEMP
           if (code_seen('S')) autotemp_min=code_value();
diff --git a/Marlin/planner.cpp b/Marlin/planner.cpp
index 0a226c6..b7f98b6 100644
--- a/Marlin/planner.cpp
+++ b/Marlin/planner.cpp
@@ -382,6 +382,7 @@ block_t *plan_get_current_block() {
 #ifdef AUTOTEMP
 void getHighESpeed()
 {
+  static float oldt=0;
   if(!autotemp_enabled)
     return;
   if(degTargetHotend0()+2<autotemp_min)  //probably temperature set to zero.
@@ -401,12 +402,21 @@ void getHighESpeed()
   }
    
   float g=autotemp_min+high*autotemp_factor;
-  float t=constrain(autotemp_min,g,autotemp_max);
+  float t=g;
+  if(t<autotemp_min)
+    t=autotemp_min;
+  if(t>autotemp_max)
+    t=autotemp_max;
+  if(oldt>t)
+  {
+    t=AUTOTEMP_OLDWEIGHT*oldt+(1-AUTOTEMP_OLDWEIGHT)*t;
+  }
+  oldt=t;
   setTargetHotend0(t);
-  SERIAL_ECHO_START;
-  SERIAL_ECHOPAIR("highe",high);
-  SERIAL_ECHOPAIR(" t",t);
-  SERIAL_ECHOLN("");
+//   SERIAL_ECHO_START;
+//   SERIAL_ECHOPAIR("highe",high);
+//   SERIAL_ECHOPAIR(" t",t);
+//   SERIAL_ECHOLN("");
 }
 #endif
 

