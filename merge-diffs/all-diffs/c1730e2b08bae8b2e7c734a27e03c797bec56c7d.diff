commit c1730e2b08bae8b2e7c734a27e03c797bec56c7d (from 0f3f5d083d6b100c6d70f4c2eed2f37b04897035)
Merge: 0f3f5d0 86358dd
Author: daid <daid303@gmail.com>
Date:   Thu Jan 10 07:19:37 2013 -0800

    Merge pull request #363 from yuroller/sanguino_panelolu
    
    Panelolu pin assignment for sanguinololu

diff --git a/Marlin/pins.h b/Marlin/pins.h
index 8e3ed07..98c423d 100644
--- a/Marlin/pins.h
+++ b/Marlin/pins.h
@@ -418,9 +418,9 @@
       #define BTN_EN2 35
       #define BTN_ENC 31  //the click
 
-      #ifdef G3D_PANEL
-        #define SDCARDDETECT 49
-      #else
+      #ifdef G3D_PANEL
+        #define SDCARDDETECT 49
+      #else
         #define SDCARDDETECT -1  // Ramps does not use this port
       #endif
     #endif
@@ -723,6 +723,39 @@
 #define SDSS               24
 #endif
 
+ #ifdef ULTRA_LCD
+   #ifdef NEWPANEL
+     //we have no buzzer installed
+     #define BEEPER -1
+     //LCD Pins
+     #define LCD_PINS_RS        4
+     #define LCD_PINS_ENABLE    17
+     #define LCD_PINS_D4        30
+     #define LCD_PINS_D5        29
+     #define LCD_PINS_D6        28
+     #define LCD_PINS_D7        27
+     
+     //The encoder and click button
+     #define BTN_EN1 11  //must be a hardware interrupt pin
+     #define BTN_EN2 10 //must be hardware interrupt pin
+     #define BTN_ENC 16  //the switch
+     //not connected to a pin
+     #define SDCARDDETECT -1
+     
+     //from the same bit in the RAMPS Newpanel define
+     //encoder rotation values
+     #define encrot0 0
+     #define encrot1 2
+     #define encrot2 3
+     #define encrot3 1
+     
+     #define BLEN_C 2
+     #define BLEN_B 1
+     #define BLEN_A 0
+     
+   #endif //Newpanel
+ #endif //Ultipanel
+ 
 #endif
 
 

commit c1730e2b08bae8b2e7c734a27e03c797bec56c7d (from 86358dd6cd0af76fdffddb642be2f90a4c1db151)
Merge: 0f3f5d0 86358dd
Author: daid <daid303@gmail.com>
Date:   Thu Jan 10 07:19:37 2013 -0800

    Merge pull request #363 from yuroller/sanguino_panelolu
    
    Panelolu pin assignment for sanguinololu

diff --git a/Marlin/Configuration_adv.h b/Marlin/Configuration_adv.h
index 98d0da2..de9f68c 100644
--- a/Marlin/Configuration_adv.h
+++ b/Marlin/Configuration_adv.h
@@ -68,8 +68,8 @@
 
 // When first starting the main fan, run it at full speed for the
 // given number of milliseconds.  This gets the fan spinning reliably
-// before setting a PWM value.  Set to zero to disable.
-#define FAN_KICKSTART_TIME 100
+// before setting a PWM value. (Does not work with software PWM for fan on Sanguinololu)
+//#define FAN_KICKSTART_TIME 100
 
 //===========================================================================
 //=============================Mechanical Settings===========================
diff --git a/Marlin/planner.cpp b/Marlin/planner.cpp
index 6173bce..5101e18 100644
--- a/Marlin/planner.cpp
+++ b/Marlin/planner.cpp
@@ -466,23 +466,23 @@ void check_axes_activity()
   }
 #if FAN_PIN > -1
   #ifndef FAN_SOFT_PWM
-  if (FAN_KICKSTART_TIME) {
-    static unsigned long FanKickEnd;
-    if (tail_fan_speed) {
-      if (FanKickEnd == 0) {
-        // Just starting up fan - run at full power.
-        FanKickEnd = millis() + FAN_KICKSTART_TIME;
-        tail_fan_speed = 255;
-      } else if (FanKickEnd > millis())
-        // Fan still spinning up.
-        tail_fan_speed = 255;
-    } else {
-      FanKickEnd = 0;
-    }
-  }
-  analogWrite(FAN_PIN,tail_fan_speed);
-  #endif
-#endif
+    #ifdef FAN_KICKSTART_TIME
+      static unsigned long fan_kick_end;
+      if (tail_fan_speed) {
+        if (fan_kick_end == 0) {
+          // Just starting up fan - run at full power.
+          fan_kick_end = millis() + FAN_KICKSTART_TIME;
+          tail_fan_speed = 255;
+        } else if (fan_kick_end > millis())
+          // Fan still spinning up.
+          tail_fan_speed = 255;
+      } else {
+        fan_kick_end = 0;
+      }
+    #endif//FAN_KICKSTART_TIME
+    analogWrite(FAN_PIN,tail_fan_speed);
+  #endif//!FAN_SOFT_PWM
+#endif//FAN_PIN > -1
 #ifdef AUTOTEMP
   getHighESpeed();
 #endif

