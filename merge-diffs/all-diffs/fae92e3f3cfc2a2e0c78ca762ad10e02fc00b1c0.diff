commit fae92e3f3cfc2a2e0c78ca762ad10e02fc00b1c0 (from d641344d3a1aa5fb895adbb2e04a34c8fe6413be)
Merge: d641344 2b226bc
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Sat Aug 27 20:22:53 2016 -0500

    Merge pull request #4718 from thinkyhead/rc_twibus_patch_20160827
    
    TWIBus patch for proper use of Wire.requestFrom

diff --git a/Marlin/twibus.cpp b/Marlin/twibus.cpp
index 11f2057..0352e1b 100644
--- a/Marlin/twibus.cpp
+++ b/Marlin/twibus.cpp
@@ -25,7 +25,6 @@
 #if ENABLED(EXPERIMENTAL_I2CBUS)
 
 #include "twibus.h"
-
 #include <Wire.h>
 
 TWIBus::TWIBus() {
@@ -121,18 +120,12 @@ bool TWIBus::request(const uint8_t bytes) {
   #endif
 
   // requestFrom() is a blocking function
-  Wire.requestFrom(this->addr, bytes);
-
-  // Wait for all bytes to arrive
-  millis_t t = millis() + this->timeout;
-  while (Wire.available() < bytes)
-    if (ELAPSED(millis(), t)) {
-      #if ENABLED(DEBUG_TWIBUS)
-        SERIAL_ECHO_START;
-        SERIAL_ECHOLNPGM("i2c timeout");
-      #endif
-      return false;
-    }
+  if (Wire.requestFrom(this->addr, bytes) == 0) {
+    #if ENABLED(DEBUG_TWIBUS)
+      debug("request fail", this->addr);
+    #endif
+    return false;
+  }
 
   return true;
 }
@@ -151,6 +144,11 @@ uint8_t TWIBus::capture(char *dst, const uint8_t bytes) {
   uint8_t count = 0;
   while (count < bytes && Wire.available())
     dst[count++] = Wire.read();
+
+  #if ENABLED(DEBUG_TWIBUS)
+    debug(PSTR("capture"), count);
+  #endif
+
   return count;
 }
 
diff --git a/Marlin/twibus.h b/Marlin/twibus.h
index d578a6d..bd2d8a5 100644
--- a/Marlin/twibus.h
+++ b/Marlin/twibus.h
@@ -55,14 +55,6 @@ typedef void (*twiRequestFunc_t)();
 class TWIBus {
   private:
     /**
-     * @brief Timeout value in milliseconds
-     * @details Maximum amount of time (ms) to wait for a reply.
-     *          Useful if something goes wrong on the bus and the
-     *          SDA/SCL lines are held up by another device.
-     */
-    const int timeout = 5;
-
-    /**
      * @brief Number of bytes on buffer
      * @description Number of bytes in the buffer waiting to be flushed to the bus
      */
@@ -165,11 +157,11 @@ class TWIBus {
     /**
      * @brief Request data from the slave device and wait.
      * @details Request a number of bytes from a slave device.
-     *          Wait for the data to arrive until the timeout
-     *          interval expires. Return true on success.
+     *          Wait for the data to arrive, and return true
+     *          on success.
      *
      * @param bytes the number of bytes to request
-     * @return status of the request: true=success, false=timeout
+     * @return status of the request: true=success, false=fail
      */
     bool request(const uint8_t bytes);
 

commit fae92e3f3cfc2a2e0c78ca762ad10e02fc00b1c0 (from 2b226bc5c2d1edf8de854e132fd8c8b7e5cf266a)
Merge: d641344 2b226bc
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Sat Aug 27 20:22:53 2016 -0500

    Merge pull request #4718 from thinkyhead/rc_twibus_patch_20160827
    
    TWIBus patch for proper use of Wire.requestFrom

diff --git a/Marlin/Marlin_main.cpp b/Marlin/Marlin_main.cpp
index 6c9ee10..d649daf 100644
--- a/Marlin/Marlin_main.cpp
+++ b/Marlin/Marlin_main.cpp
@@ -1601,21 +1601,6 @@ static void set_axis_is_at_home(AxisEnum axis) {
       #endif
     }
 
-    #if HAS_BED_PROBE && Z_HOME_DIR < 0 && DISABLED(Z_MIN_PROBE_ENDSTOP)
-      if (axis == Z_AXIS) {
-        current_position[Z_AXIS] -= zprobe_zoffset;
-        #if ENABLED(DEBUG_LEVELING_FEATURE)
-          if (DEBUGGING(LEVELING)) {
-            SERIAL_ECHOLNPGM("*** Z HOMED WITH PROBE (Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN) ***");
-            SERIAL_ECHOLNPAIR("> zprobe_zoffset = ", zprobe_zoffset);
-          }
-        #endif
-      }
-    #elif HAS_BED_PROBE && Z_HOME_DIR < 0 && ENABLED(DEBUG_LEVELING_FEATURE)
-      if (DEBUGGING(LEVELING))
-        SERIAL_ECHOLNPGM("*** Z HOMED TO ENDSTOP (Z_MIN_PROBE_ENDSTOP) ***");
-    #endif
-
     #if ENABLED(DEBUG_LEVELING_FEATURE)
       if (DEBUGGING(LEVELING)) {
         SERIAL_ECHOPAIR("> home_offset[", axis_codes[axis]);
diff --git a/Marlin/language.h b/Marlin/language.h
index 052cfe8..e6c1b8e 100644
--- a/Marlin/language.h
+++ b/Marlin/language.h
@@ -244,6 +244,32 @@
 #define LANGUAGE_INCL(M) LANGUAGE_INCL_(M)
 #define INCLUDE_LANGUAGE LANGUAGE_INCL(LCD_LANGUAGE)
 
+// Never translate these strings
+#define MSG_X "X"
+#define MSG_Y "Y"
+#define MSG_Z "Z"
+#define MSG_E "E"
+#define MSG_H1 "1"
+#define MSG_H2 "2"
+#define MSG_H3 "3"
+#define MSG_H4 "4"
+#define MSG_N1 " 1"
+#define MSG_N2 " 2"
+#define MSG_N3 " 3"
+#define MSG_N4 " 4"
+#define MSG_E1 " E1"
+#define MSG_E2 " E2"
+#define MSG_E3 " E3"
+#define MSG_E4 " E4"
+#define MSG_MOVE_E1 "1"
+#define MSG_MOVE_E2 "2"
+#define MSG_MOVE_E3 "3"
+#define MSG_MOVE_E4 "4"
+#define MSG_DIAM_E1 " 1"
+#define MSG_DIAM_E2 " 2"
+#define MSG_DIAM_E3 " 3"
+#define MSG_DIAM_E4 " 4"
+
 #include INCLUDE_LANGUAGE
 
 #if DISABLED(SIMULATE_ROMFONT) && DISABLED(DISPLAY_CHARSET_ISO10646_1) && DISABLED(DISPLAY_CHARSET_ISO10646_5) && DISABLED(DISPLAY_CHARSET_ISO10646_KANA) && DISABLED(DISPLAY_CHARSET_ISO10646_GREEK) && DISABLED(DISPLAY_CHARSET_ISO10646_CN)
diff --git a/Marlin/language_da.h b/Marlin/language_da.h
index b4cf853..88fa8bc 100644
--- a/Marlin/language_da.h
+++ b/Marlin/language_da.h
@@ -39,19 +39,19 @@
 #define MSG_LCD_ENDSTOPS                    "Endstops" // Max length 8 characters
 #define MSG_MAIN                            "Menu"
 #define MSG_AUTOSTART                       "Autostart"
-#define MSG_DISABLE_STEPPERS                "SlÃ¥ alle steppere fra"
+#define MSG_DISABLE_STEPPERS                "Slå alle steppere fra"
 #define MSG_AUTO_HOME                       "Auto Home" // G28
 #define MSG_AUTO_HOME_X                     "Home X"
 #define MSG_AUTO_HOME_Y                     "Home Y"
 #define MSG_AUTO_HOME_Z                     "Home Z"
 #define MSG_LEVEL_BED_HOMING                "Homing XYZ"
-#define MSG_LEVEL_BED_WAITING               "Tryk for at starte bed level"
-#define MSG_LEVEL_BED_NEXT_POINT            "NÃ¦ste punkt"
-#define MSG_LEVEL_BED_DONE                  "Bed level er fÃ¦rdig!"
+#define MSG_LEVEL_BED_WAITING               "Klik når du er klar"
+#define MSG_LEVEL_BED_NEXT_POINT            "Næste punkt"
+#define MSG_LEVEL_BED_DONE                  "Bed level er færdig!"
 #define MSG_LEVEL_BED_CANCEL                "Annuller bed level"
-#define MSG_SET_HOME_OFFSETS                "SÃ¦t forskyding af home"
-#define MSG_HOME_OFFSETS_APPLIED            "Forskydninger af home pos. er tilfÃ¸jet"
-#define MSG_SET_ORIGIN                      "SÃ¦t origin"
+#define MSG_SET_HOME_OFFSETS                "Sæt forsk. af home"
+#define MSG_HOME_OFFSETS_APPLIED            "Forsk. er nu aktiv"
+#define MSG_SET_ORIGIN                      "Sæt origin"
 #define MSG_PREHEAT_1                       "Forvarm PLA"
 #define MSG_PREHEAT_1_N                     "Forvarm PLA "
 #define MSG_PREHEAT_1_ALL                   "Forvarm PLA Alle"
@@ -62,9 +62,9 @@
 #define MSG_PREHEAT_2_ALL                   "Forvarm ABS Alle"
 #define MSG_PREHEAT_2_BEDONLY               "Forvarm ABS Bed"
 #define MSG_PREHEAT_2_SETTINGS              "Forvarm ABS conf"
-#define MSG_COOLDOWN                        "AfkÃ¸l"
-#define MSG_SWITCH_PS_ON                    "SlÃ¥ strÃ¸m til"
-#define MSG_SWITCH_PS_OFF                   "SlÃ¥ strÃ¸m fra"
+#define MSG_COOLDOWN                        "Afkøl"
+#define MSG_SWITCH_PS_ON                    "Slå strøm til"
+#define MSG_SWITCH_PS_OFF                   "Slå strøm fra"
 #define MSG_EXTRUDE                         "Extruder"
 #define MSG_RETRACT                         "Retract"
 #define MSG_MOVE_AXIS                       "Flyt akser"
@@ -79,8 +79,9 @@
 #define MSG_SPEED                           "Hastighed"
 #define MSG_BED_Z                           "Plade Z"
 #define MSG_NOZZLE                          "Dyse"
+
 #define MSG_BED                             "Plade"
-#define MSG_FAN_SPEED                       "BlÃ¦ser hastighed"
+#define MSG_FAN_SPEED                       "Blæser hastighed"
 #define MSG_FLOW                            "Flow"
 #define MSG_CONTROL                         "Kontrol"
 #define MSG_MIN                             " \002 Min"
@@ -93,6 +94,7 @@
 #define MSG_PID_I                           "PID-I"
 #define MSG_PID_D                           "PID-D"
 #define MSG_PID_C                           "PID-C"
+#define MSG_SELECT                          "Vælg"
 #define MSG_ACC                             "Accel"
 #define MSG_VXY_JERK                        "Vxy-jerk"
 #define MSG_VZ_JERK                         "Vz-jerk"
@@ -108,7 +110,7 @@
 #define MSG_ZSTEPS                          "Zsteps/mm"
 #define MSG_ESTEPS                          "Esteps/mm"
 #define MSG_TEMPERATURE                     "Temperatur"
-#define MSG_MOTION                          "BevÃ¦gelse"
+#define MSG_MOTION                          "Bevægelse"
 #define MSG_VOLUMETRIC                      "Filament"
 #define MSG_VOLUMETRIC_ENABLED              "E in mm3"
 #define MSG_FILAMENT_DIAM                   "Fil. Dia."
@@ -117,24 +119,24 @@
 #define MSG_LOAD_EPROM                      "Hent fra EEPROM"
 #define MSG_RESTORE_FAILSAFE                "Gendan failsafe"
 #define MSG_REFRESH                         "Genopfrisk"
-#define MSG_WATCH                           "Info skÃ¦rm"
+#define MSG_WATCH                           "Info skærm"
 #define MSG_PREPARE                         "Forbered"
 #define MSG_TUNE                            "Tune"
 #define MSG_PAUSE_PRINT                     "Pause printet"
-#define MSG_RESUME_PRINT                    "ForsÃ¦t printet"
+#define MSG_RESUME_PRINT                    "Forsæt printet"
 #define MSG_STOP_PRINT                      "Stop printet"
 #define MSG_CARD_MENU                       "Print fra SD"
 #define MSG_NO_CARD                         "Intet SD kort"
 #define MSG_DWELL                           "Dvale..."
-#define MSG_USERWAIT                        "Venter pÃ¥ bruger..."
-#define MSG_RESUMING                        "ForsÃ¦tter printet"
+#define MSG_USERWAIT                        "Venter på bruger..."
+#define MSG_RESUMING                        "Forsætter printet"
 #define MSG_PRINT_ABORTED                   "Print annulleret"
-#define MSG_NO_MOVE                         "Ingen bevÃ¦gelse."
-#define MSG_KILLED                          "DRÃBT. "
+#define MSG_NO_MOVE                         "Ingen bevægelse."
+#define MSG_KILLED                          "DRÆBT. "
 #define MSG_STOPPED                         "STOPPET. "
-#define MSG_CONTROL_RETRACT                 "TilbagetrÃ¦k mm"
+#define MSG_CONTROL_RETRACT                 "Tilbagetræk mm"
 #define MSG_CONTROL_RETRACT_SWAP            "Skift Re.mm"
-#define MSG_CONTROL_RETRACTF                "TilbagetrÃ¦k V"
+#define MSG_CONTROL_RETRACTF                "Tilbagetræk V"
 #define MSG_CONTROL_RETRACT_ZLIFT           "Hop mm"
 #define MSG_CONTROL_RETRACT_RECOVER         "UnRet +mm"
 #define MSG_CONTROL_RETRACT_RECOVER_SWAP    "S UnRet+mm"
@@ -145,19 +147,24 @@
 #define MSG_CNG_SDCARD                      "Skift SD kort"
 #define MSG_ZPROBE_OUT                      "Probe udenfor plade"
 #define MSG_HOME                            "Home"  // Used as MSG_HOME " " MSG_X MSG_Y MSG_Z " " MSG_FIRST
-#define MSG_FIRST                           "first"
+#define MSG_FIRST                           "først"
 #define MSG_ZPROBE_ZOFFSET                  "Z Offset"
 #define MSG_BABYSTEP_X                      "Babystep X"
 #define MSG_BABYSTEP_Y                      "Babystep Y"
 #define MSG_BABYSTEP_Z                      "Babystep Z"
 #define MSG_ENDSTOP_ABORT                   "Endstop abort"
-#define MSG_HEATING_FAILED_LCD              "Opvarmning mislykkedes"
+#define MSG_HEATING_FAILED_LCD              "Opvarmning fejlet"
 #define MSG_ERR_REDUNDANT_TEMP              "Fejl: reserve temp"
-#define MSG_THERMAL_RUNAWAY                 "Temp lÃ¸ber lÃ¸bsk"
-#define MSG_ERR_MAXTEMP                     "Fejl: Maks temp"
-#define MSG_ERR_MINTEMP                     "Fejl: Min temp"
-#define MSG_ERR_MAXTEMP_BED                 "Fejl: Maks Plsde temp"
-#define MSG_ERR_MINTEMP_BED                 "Fejl: Min Plade temp"
+#define MSG_THERMAL_RUNAWAY                 "Temp løber løbsk"
+#define MSG_ERR_MAXTEMP                     "Fejl: MAKSTEMP"
+#define MSG_ERR_MINTEMP                     "Fejl: MINTEMP"
+#define MSG_ERR_MAXTEMP_BED                 "Fejl: MAKSTEMP PLADE"
+#define MSG_ERR_MINTEMP_BED                 "Fejl: MINTEMP PLADE"
+#define MSG_HALTED                          "PRINTER HALTED"
+#define MSG_PLEASE_RESET                    "Reset venligst"
+#define MSG_SHORT_DAY                       "d" // One character only
+#define MSG_SHORT_HOUR                      "h" // One character only
+#define MSG_SHORT_MINUTE                    "m" // One character only
 #define MSG_HEATING                         "Opvarmer..."
 #define MSG_HEATING_COMPLETE                "Opvarmet"
 #define MSG_BED_HEATING                     "Opvarmer plade"
@@ -168,4 +175,60 @@
 #define MSG_DELTA_CALIBRATE_Z               "Kalibrer Z"
 #define MSG_DELTA_CALIBRATE_CENTER          "Kalibrerings Center"
 
+#define MSG_INFO_MENU                       "Om Printer"
+#define MSG_INFO_PRINTER_MENU               "Printer Info"
+#define MSG_INFO_STATS_MENU                 "Printer Stat."
+#define MSG_INFO_BOARD_MENU                 "Board Info"
+#define MSG_INFO_THERMISTOR_MENU            "Thermistors"
+#define MSG_INFO_EXTRUDERS                  "Extrudere"
+#define MSG_INFO_BAUDRATE                   "Baud"
+#define MSG_INFO_PROTOCOL                   "Protocol"
+
+#if LCD_WIDTH > 19
+  #define MSG_INFO_PRINT_COUNT              "Antal Print"
+  #define MSG_INFO_COMPLETED_PRINTS         "Færdige"
+  #define MSG_INFO_PRINT_TIME               "Total print tid"
+  #define MSG_INFO_PRINT_LONGEST            "Længste print tid"
+  #define MSG_INFO_PRINT_FILAMENT           "Total extruderet"
+#else
+  #define MSG_INFO_PRINT_COUNT              "Prints"
+  #define MSG_INFO_COMPLETED_PRINTS         "Færdige"
+  #define MSG_INFO_PRINT_TIME               "Total"
+  #define MSG_INFO_PRINT_LONGEST            "Længste"
+  #define MSG_INFO_PRINT_FILAMENT           "Extruderet"
+#endif
+
+#define MSG_INFO_MIN_TEMP                   "Min Temp"
+#define MSG_INFO_MAX_TEMP                   "Max Temp"
+#define MSG_INFO_PSU                        "Strømforsyning"
+
+#define MSG_FILAMENT_CHANGE_HEADER          "SKIFT FILAMENT"
+#define MSG_FILAMENT_CHANGE_OPTION_HEADER   "SKIFTE MULIGHEDER:"
+#define MSG_FILAMENT_CHANGE_OPTION_EXTRUDE  "Extruder mere"
+#define MSG_FILAMENT_CHANGE_OPTION_RESUME   "forsæt print"
+
+#if LCD_HEIGHT >= 4
+  #define MSG_FILAMENT_CHANGE_INIT_1          "Vent på"
+  #define MSG_FILAMENT_CHANGE_INIT_2          "skift af "
+  #define MSG_FILAMENT_CHANGE_INIT_3          "filament"
+  #define MSG_FILAMENT_CHANGE_UNLOAD_1        "Vent på"
+  #define MSG_FILAMENT_CHANGE_UNLOAD_2        "filament tømning"
+  #define MSG_FILAMENT_CHANGE_INSERT_1        "indsæt filament"
+  #define MSG_FILAMENT_CHANGE_INSERT_2        "og tryk for"
+  #define MSG_FILAMENT_CHANGE_INSERT_3        "at fortsætte..."
+  #define MSG_FILAMENT_CHANGE_LOAD_1          "Vent på"
+  #define MSG_FILAMENT_CHANGE_LOAD_2          "filament fødning"
+  #define MSG_FILAMENT_CHANGE_EXTRUDE_1       "Vent på"
+  #define MSG_FILAMENT_CHANGE_EXTRUDE_2       "filament extrudere"
+  #define MSG_FILAMENT_CHANGE_RESUME_1        "Vent på at"
+  #define MSG_FILAMENT_CHANGE_RESUME_2        "print forsætter"
+#else // LCD_HEIGHT < 4
+  #define MSG_FILAMENT_CHANGE_INIT_1          "Vent venligst..."
+  #define MSG_FILAMENT_CHANGE_UNLOAD_1        "Tømmer..."
+  #define MSG_FILAMENT_CHANGE_INSERT_1        "Indsæt og klik"
+  #define MSG_FILAMENT_CHANGE_LOAD_1          "Føder..."
+  #define MSG_FILAMENT_CHANGE_EXTRUDE_1       "Extrudere..."
+  #define MSG_FILAMENT_CHANGE_RESUME_1        "Fortsætter..."
+#endif // LCD_HEIGHT < 4
+
 #endif // LANGUAGE_DA_H
diff --git a/Marlin/language_en.h b/Marlin/language_en.h
index 560c44b..a0443f4 100644
--- a/Marlin/language_en.h
+++ b/Marlin/language_en.h
@@ -608,30 +608,4 @@
   #endif
 #endif // LCD_HEIGHT < 4
 
-// Never translate these strings
-#define MSG_X "X"
-#define MSG_Y "Y"
-#define MSG_Z "Z"
-#define MSG_E "E"
-#define MSG_H1 "1"
-#define MSG_H2 "2"
-#define MSG_H3 "3"
-#define MSG_H4 "4"
-#define MSG_N1 " 1"
-#define MSG_N2 " 2"
-#define MSG_N3 " 3"
-#define MSG_N4 " 4"
-#define MSG_E1 " E1"
-#define MSG_E2 " E2"
-#define MSG_E3 " E3"
-#define MSG_E4 " E4"
-#define MSG_MOVE_E1 "1"
-#define MSG_MOVE_E2 "2"
-#define MSG_MOVE_E3 "3"
-#define MSG_MOVE_E4 "4"
-#define MSG_DIAM_E1 " 1"
-#define MSG_DIAM_E2 " 2"
-#define MSG_DIAM_E3 " 3"
-#define MSG_DIAM_E4 " 4"
-
 #endif // LANGUAGE_EN_H

