commit 2e3110539bbfbc71db2317d18dbac1bfc875c43b (from 4ec7ed554d3d8634980ccf2fd900b322b4c9b508)
Merge: 4ec7ed5 3f94b15
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Wed Oct 26 21:48:19 2016 -0500

    Merge pull request #5095 from thinkyhead/rc_fix_bilinear_math
    
    Fix bilinear grid constraints

diff --git a/Marlin/Marlin_main.cpp b/Marlin/Marlin_main.cpp
index b99ae27..2242932 100755
--- a/Marlin/Marlin_main.cpp
+++ b/Marlin/Marlin_main.cpp
@@ -8310,15 +8310,17 @@ void ok_to_send() {
     float ratio_x = x / bilinear_grid_spacing[X_AXIS],
           ratio_y = y / bilinear_grid_spacing[Y_AXIS];
 
-    // Whole unit is the grid box index
-    const int gridx = constrain(floor(ratio_x), 0, ABL_GRID_POINTS_X - 2),
-              gridy = constrain(floor(ratio_y), 0, ABL_GRID_POINTS_Y - 2),
-              nextx = min(gridx + 1, ABL_GRID_POINTS_X - 2),
-              nexty = min(gridy + 1, ABL_GRID_POINTS_Y - 2);
+    // Whole units for the grid line indices. Constrained within bounds.
+    const int gridx = constrain(floor(ratio_x), 0, ABL_GRID_POINTS_X - 1),
+              gridy = constrain(floor(ratio_y), 0, ABL_GRID_POINTS_Y - 1),
+              nextx = min(gridx + 1, ABL_GRID_POINTS_X - 1),
+              nexty = min(gridy + 1, ABL_GRID_POINTS_Y - 1);
 
     // Subtract whole to get the ratio within the grid box
-    ratio_x = constrain(ratio_x - gridx, 0.0, 1.0);
-    ratio_y = constrain(ratio_y - gridy, 0.0, 1.0);
+    ratio_x -= gridx; ratio_y -= gridy;
+
+    // Never less than 0.0. (Over 1.0 is fine due to previous contraints.)
+    NOLESS(ratio_x, 0); NOLESS(ratio_y, 0);
 
     // Z at the box corners
     const float z1 = bed_level_grid[gridx][gridy],  // left-front

commit 2e3110539bbfbc71db2317d18dbac1bfc875c43b (from 3f94b15cef2ffee007a77be5fb278520a538d242)
Merge: 4ec7ed5 3f94b15
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Wed Oct 26 21:48:19 2016 -0500

    Merge pull request #5095 from thinkyhead/rc_fix_bilinear_math
    
    Fix bilinear grid constraints

diff --git a/Marlin/pins_AZTEEG_X3.h b/Marlin/pins_AZTEEG_X3.h
index 63be892..26f274e 100644
--- a/Marlin/pins_AZTEEG_X3.h
+++ b/Marlin/pins_AZTEEG_X3.h
@@ -32,6 +32,9 @@
 
 #include "pins_RAMPS_13.h"
 
+//
+// Servos
+//
 #undef SERVO0_PIN
 #undef SERVO1_PIN
 #define SERVO0_PIN  44  // SERVO1 port
diff --git a/Marlin/pins_RAMPS.h b/Marlin/pins_RAMPS.h
index 00f9308..e1d9c87 100644
--- a/Marlin/pins_RAMPS.h
+++ b/Marlin/pins_RAMPS.h
@@ -344,14 +344,14 @@
       #else
         #define BTN_EN1 37
         #define BTN_EN2 35
-        #define BTN_ENC 31  // the click
+        #define BTN_ENC 31 // the click
       #endif
 
       #if ENABLED(G3D_PANEL)
         #define SD_DETECT_PIN 49
         #define KILL_PIN 41
       #else
-        //        #define SD_DETECT_PIN -1  // Ramps doesn't use this
+        //#define SD_DETECT_PIN -1 // Ramps doesn't use this
       #endif
 
     #endif

